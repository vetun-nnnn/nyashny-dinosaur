<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Няшный динозаврик: Игра про котёнка</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #ffd6e7 0%, #c1f0ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #5a3d5c;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 900;
            color: #ff6b9d;
            text-shadow: 3px 3px 0 #ffd1e0;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #7a5b7d;
            margin-bottom: 20px;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            background-color: #fff9fd;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(255, 107, 157, 0.2);
            overflow: hidden;
            border: 8px solid #ffb8d0;
        }

        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(to right, #ff6b9d, #ff8ab4);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(to right, #6bc6ff, #8fd4ff);
            color: white;
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-top: 25px;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.15);
        }

        .stat-box {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 900;
            color: #ff6b9d;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: #7a5b7d;
            font-weight: 700;
        }

        .cat-forms {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .cat-form {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background-color: white;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .cat-form.active {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px #ff6b9d, 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .instructions {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 25px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.15);
        }

        .instructions h3 {
            color: #ff6b9d;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .instructions p {
            margin-bottom: 8px;
            color: #5a3d5c;
        }

        .instructions ul {
            padding-left: 20px;
            margin-top: 5px;
        }

        .instructions li {
            margin-bottom: 5px;
            color: #5a3d5c;
        }

        .mobile-controls {
            display: none;
            margin-top: 20px;
            gap: 20px;
        }

        .mobile-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(to bottom, #ff6b9d, #ff8ab4);
            color: white;
            font-size: 1.8rem;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 15px rgba(255, 107, 157, 0.3);
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 20px;
        }

        .game-over h2 {
            font-size: 3.5rem;
            color: #ff6b9d;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #ffd1e0;
        }

        .game-over p {
            font-size: 1.5rem;
            color: #5a3d5c;
            margin-bottom: 30px;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
        }

        .speed-bar {
            width: 100%;
            height: 10px;
            background-color: #e9e9e9;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .speed-fill {
            height: 100%;
            background: linear-gradient(to right, #6bc6ff, #ff6b9d);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        .footer {
            margin-top: 25px;
            text-align: center;
            color: #7a5b7d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .game-container {
                height: 300px;
            }
            
            .mobile-controls {
                display: flex;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 480px) {
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .stat-box {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Няшный динозаврик</h1>
        <div class="subtitle">Помоги котёнку избегать препятствий и превратиться в могучего кота!</div>
    </div>

    <div class="game-container">
        <canvas id="game-canvas"></canvas>
        <div class="game-over" id="game-over">
            <h2>Игра окончена!</h2>
            <p>Счёт: <span id="final-score">0</span></p>
            <p>Рекорд: <span id="final-high-score">0</span></p>
            <button class="btn btn-primary" id="restart-btn">
                <i class="fas fa-redo"></i> Играть снова
            </button>
        </div>
    </div>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-value" id="score">0</div>
            <div class="stat-label"><i class="fas fa-heart"></i> Очки</div>
            <div class="speed-bar">
                <div class="speed-fill" id="speed-fill"></div>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="high-score">0</div>
            <div class="stat-label"><i class="fas fa-trophy"></i> Рекорд</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="speed">1x</div>
            <div class="stat-label"><i class="fas fa-tachometer-alt"></i> Скорость</div>
        </div>
    </div>

    <div class="cat-forms">
        <div class="cat-form active" id="form-kitten">
            <i class="fas fa-cat"></i>
        </div>
        <div class="cat-form" id="form-teen">
            <i class="fas fa-cat"></i>
        </div>
        <div class="cat-form" id="form-adult">
            <i class="fas fa-crow"></i>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-primary" id="start-btn">
            <i class="fas fa-play"></i> Начать игру
        </button>
        <button class="btn btn-secondary" id="jump-btn">
            <i class="fas fa-arrow-up"></i> Прыжок (Пробел/Клик)
        </button>
        <button class="btn btn-secondary" id="sound-btn">
            <i class="fas fa-volume-up"></i> Звук Вкл
        </button>
    </div>

    <div class="mobile-controls">
        <button class="mobile-btn" id="mobile-jump">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <div class="instructions">
        <h3>Как играть:</h3>
        <p>Котёнок бежит автоматически. Помоги ему избегать препятствий:</p>
        <ul>
            <li><strong>Пробел</strong>, <strong>Клик</strong> или <strong>Стрелка вверх</strong> - прыжок</li>
            <li>Каждые 10 секунд скорость увеличивается</li>
            <li>После 50 очков котёнок становится подростком</li>
            <li>После 100 очков превращается в могучего кота</li>
        </ul>
    </div>

    <div class="footer">
        Сделано с <i class="fas fa-heart" style="color:#ff6b9d"></i> для любителей няшных котят
    </div>

    <audio id="jump-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-cat-meow-117.mp3" type="audio/mpeg">
    </audio>
    <audio id="transform-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-300.mp3" type="audio/mpeg">
    </audio>
    <audio id="gameover-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-sad-game-over-trombone-471.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Игровые переменные
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('start-btn');
        const jumpBtn = document.getElementById('jump-btn');
        const mobileJumpBtn = document.getElementById('mobile-jump');
        const soundBtn = document.getElementById('sound-btn');
        const restartBtn = document.getElementById('restart-btn');
        const gameOverScreen = document.getElementById('game-over');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('high-score');
        const speedElement = document.getElementById('speed');
        const speedFill = document.getElementById('speed-fill');
        const finalScoreElement = document.getElementById('final-score');
        const finalHighScoreElement = document.getElementById('final-high-score');
        
        // Элементы форм кота
        const formKitten = document.getElementById('form-kitten');
        const formTeen = document.getElementById('form-teen');
        const formAdult = document.getElementById('form-adult');
        
        // Звуковые элементы
        const jumpSound = document.getElementById('jump-sound');
        const transformSound = document.getElementById('transform-sound');
        const gameoverSound = document.getElementById('gameover-sound');
        
        // Размеры canvas
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        
        // Константы для позиционирования
        const GROUND_HEIGHT = 100;
        const GROUND_LEVEL = canvas.height - GROUND_HEIGHT;
        
        // Игровые настройки
        let game = {
            running: false,
            score: 0,
            highScore: localStorage.getItem('catHighScore') || 0,
            speed: 1,
            baseSpeed: 5,
            speedIncreaseTimer: 0,
            speedIncreaseInterval: 10000, // 10 секунд
            frames: 0,
            lastTime: 0,
            gravity: 0.5,
            soundEnabled: true
        };
        
        // Кот
        let cat = {
            x: 100,
            y: GROUND_LEVEL - 60, // Кот стоит на земле
            width: 60,
            height: 60,
            velocityY: 0,
            jumpForce: 14,
            isJumping: false,
            form: 0, // 0 - котёнок, 1 - подросток, 2 - взрослый кот
            color: '#FF9EBD'
        };
        
        // Препятствия
        let obstacles = [];
        const obstacleTypes = [
            { name: 'подушка', color: '#B5EAD7', width: 50, height: 40 },
            { name: 'клубок', color: '#FFB7B2', width: 45, height: 45 },
            { name: 'чашка', color: '#C7CEEA', width: 40, height: 55 }
        ];
        
        // Фоновые элементы
        let backgroundElements = [];
        let particles = [];
        
        // Инициализация игры
        function init() {
            game.score = 0;
            game.speed = 1;
            game.speedIncreaseTimer = 0;
            game.frames = 0;
            
            cat.y = GROUND_LEVEL - cat.height;
            cat.velocityY = 0;
            cat.isJumping = false;
            cat.form = 0;
            cat.color = '#FF9EBD';
            cat.width = 60;
            cat.height = 60;
            
            obstacles = [];
            backgroundElements = [];
            particles = [];
            
            // Создаем фоновые элементы (облака, птички, бабочки)
            for (let i = 0; i < 8; i++) {
                backgroundElements.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * (GROUND_LEVEL - 100),
                    type: Math.random() > 0.5 ? 'cloud' : (Math.random() > 0.5 ? 'bird' : 'butterfly'),
                    speed: 0.5 + Math.random() * 1.5
                });
            }
            
            // Обновляем интерфейс
            updateUI();
            
            // Показываем начальную форму
            updateCatForm();
            
            // Скрываем экран завершения игры
            gameOverScreen.style.display = 'none';
            
            // Запускаем игровой цикл
            if (!game.running) {
                game.running = true;
                requestAnimationFrame(gameLoop);
            }
        }
        
        // Игровой цикл
        function gameLoop(timestamp) {
            if (!game.lastTime) game.lastTime = timestamp;
            const deltaTime = timestamp - game.lastTime;
            game.lastTime = timestamp;
            
            // Очистка canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Обновление игры
            update(deltaTime);
            
            // Отрисовка игры
            draw();
            
            // Увеличиваем счетчик кадров
            game.frames++;
            
            // Продолжаем цикл, если игра запущена
            if (game.running) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        // Обновление игрового состояния
        function update(deltaTime) {
            // Обновление кота
            updateCat(deltaTime);
            
            // Обновление препятствий
            updateObstacles(deltaTime);
            
            // Обновление фоновых элементов
            updateBackgroundElements(deltaTime);
            
            // Обновление частиц
            updateParticles(deltaTime);
            
            // Увеличение скорости со временем
            game.speedIncreaseTimer += deltaTime;
            if (game.speedIncreaseTimer >= game.speedIncreaseInterval) {
                game.speedIncreaseTimer = 0;
                game.speed += 0.2;
                
                // Обновляем индикатор скорости
                speedFill.style.width = Math.min(100, (game.speed - 1) / 3 * 100) + '%';
                speedElement.textContent = game.speed.toFixed(1) + 'x';
                
                // Создаем частицы при увеличении скорости
                createParticles(canvas.width / 2, 50, 10, '#6BC6FF');
            }
            
            // Генерация новых препятствий
            if (game.frames % Math.max(60, 120 - game.score) === 0) {
                generateObstacle();
            }
            
            // Проверка столкновений
            checkCollisions();
            
            // Увеличение счета
            game.score += 0.1 * game.speed;
            
            // Проверка трансформации кота
            checkTransformation();
            
            // Обновление интерфейса
            updateUI();
        }
        
        // Обновление состояния кота
        function updateCat(deltaTime) {
            // Гравитация
            cat.velocityY += game.gravity;
            cat.y += cat.velocityY;
            
            // Ограничение на землю
            const groundLevel = GROUND_LEVEL - cat.height;
            if (cat.y > groundLevel) {
                cat.y = groundLevel;
                cat.velocityY = 0;
                cat.isJumping = false;
            }
        }
        
        // Обновление препятствий
        function updateObstacles(deltaTime) {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                
                // Движение препятствия
                obstacle.x -= game.baseSpeed * game.speed;
                
                // Удаление препятствий, вышедших за экран
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(i, 1);
                }
            }
        }
        
        // Обновление фоновых элементов
        function updateBackgroundElements(deltaTime) {
            for (let element of backgroundElements) {
                element.x -= element.speed * game.speed * 0.5;
                
                // Если элемент ушел за экран, перемещаем его в начало
                if (element.x + 100 < 0) {
                    element.x = canvas.width + 50;
                    element.y = Math.random() * (GROUND_LEVEL - 100);
                }
            }
        }
        
        // Обновление частиц
        function updateParticles(deltaTime) {
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vy += 0.05; // Гравитация для частиц
                particle.life--;
                
                // Удаление частиц с истекшим временем жизни
                if (particle.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }
        
        // Генерация нового препятствия
        function generateObstacle() {
            const typeIndex = Math.floor(Math.random() * obstacleTypes.length);
            const obstacleType = obstacleTypes[typeIndex];
            
            obstacles.push({
                x: canvas.width,
                y: GROUND_LEVEL - obstacleType.height, // Препятствие стоит на земле
                width: obstacleType.width,
                height: obstacleType.height,
                color: obstacleType.color,
                type: obstacleType.name
            });
        }
        
        // Проверка столкновений
        function checkCollisions() {
            const catRect = {
                x: cat.x + 20, // Уменьшаем хитбокс кота для более справедливого геймплея
                y: cat.y + 10,
                width: cat.width - 40,
                height: cat.height - 20
            };
            
            for (let obstacle of obstacles) {
                const obstacleRect = {
                    x: obstacle.x + 5,
                    y: obstacle.y + 5,
                    width: obstacle.width - 10,
                    height: obstacle.height - 10
                };
                
                // Проверка прямоугольного пересечения
                if (
                    catRect.x < obstacleRect.x + obstacleRect.width &&
                    catRect.x + catRect.width > obstacleRect.x &&
                    catRect.y < obstacleRect.y + obstacleRect.height &&
                    catRect.y + catRect.height > obstacleRect.y
                ) {
                    // Столкновение!
                    gameOver();
                    break;
                }
            }
        }
        
        // Проверка трансформации кота
        function checkTransformation() {
            let newForm = 0;
            
            if (game.score >= 100) {
                newForm = 2; // Взрослый кот
            } else if (game.score >= 50) {
                newForm = 1; // Подросток
            }
            
            // Если форма изменилась
            if (newForm !== cat.form) {
                cat.form = newForm;
                updateCatForm();
                
                // Эффект трансформации
                createParticles(cat.x + cat.width / 2, cat.y + cat.height / 2, 30, '#FFD166');
                
                // Звук трансформации
                if (game.soundEnabled) {
                    transformSound.currentTime = 0;
                    transformSound.play().catch(e => console.log("Audio error:", e));
                }
            }
        }
        
        // Обновление формы кота
        function updateCatForm() {
            // Сбрасываем активные классы
            formKitten.classList.remove('active');
            formTeen.classList.remove('active');
            formAdult.classList.remove('active');
            
            // Устанавливаем активную форму
            if (cat.form === 0) {
                formKitten.classList.add('active');
                cat.color = '#FF9EBD';
                cat.width = 60;
                cat.height = 60;
                cat.y = GROUND_LEVEL - cat.height; // Обновляем позицию при изменении размера
            } else if (cat.form === 1) {
                formTeen.classList.add('active');
                cat.color = '#FF8AB4';
                cat.width = 70;
                cat.height = 65;
                cat.y = GROUND_LEVEL - cat.height; // Обновляем позицию при изменении размера
            } else {
                formAdult.classList.add('active');
                cat.color = '#FF6B9D';
                cat.width = 80;
                cat.height = 70;
                cat.y = GROUND_LEVEL - cat.height; // Обновляем позицию при изменении размера
            }
        }
        
        // Отрисовка игры
        function draw() {
            // Фон
            drawBackground();
            
            // Фоновые элементы
            drawBackgroundElements();
            
            // Земля
            drawGround();
            
            // Препятствия
            drawObstacles();
            
            // Кот
            drawCat();
            
            // Частицы
            drawParticles();
        }
        
        // Отрисовка фона
        function drawBackground() {
            // Градиентное небо
            const skyGradient = ctx.createLinearGradient(0, 0, 0, GROUND_LEVEL);
            skyGradient.addColorStop(0, '#C1F0FF');
            skyGradient.addColorStop(1, '#FFD6E7');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, GROUND_LEVEL);
            
            // Солнце
            ctx.fillStyle = '#FFF9B2';
            ctx.beginPath();
            ctx.arc(canvas.width - 80, 80, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // Лучи солнца
            ctx.strokeStyle = '#FFF9B2';
            ctx.lineWidth = 4;
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const x1 = canvas.width - 80 + Math.cos(angle) * 50;
                const y1 = 80 + Math.sin(angle) * 50;
                const x2 = canvas.width - 80 + Math.cos(angle) * 70;
                const y2 = 80 + Math.sin(angle) * 70;
                
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }
        }
        
        // Отрисовка фоновых элементов
        function drawBackgroundElements() {
            for (let element of backgroundElements) {
                if (element.type === 'cloud') {
                    // Облако
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.beginPath();
                    ctx.arc(element.x, element.y, 15, 0, Math.PI * 2);
                    ctx.arc(element.x + 20, element.y - 5, 20, 0, Math.PI * 2);
                    ctx.arc(element.x + 40, element.y, 15, 0, Math.PI * 2);
                    ctx.fill();
                } else if (element.type === 'bird') {
                    // Птичка
                    ctx.fillStyle = '#FF9EBD';
                    ctx.beginPath();
                    ctx.ellipse(element.x, element.y, 10, 5, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Крыло
                    ctx.beginPath();
                    ctx.ellipse(element.x - 5, element.y - 3, 8, 4, Math.PI / 4, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // Бабочка
                    ctx.fillStyle = '#C7CEEA';
                    // Левое крыло
                    ctx.beginPath();
                    ctx.ellipse(element.x - 8, element.y, 10, 5, Math.PI / 4, 0, Math.PI * 2);
                    ctx.fill();
                    // Правое крыло
                    ctx.beginPath();
                    ctx.ellipse(element.x + 8, element.y, 10, 5, -Math.PI / 4, 0, Math.PI * 2);
                    ctx.fill();
                    // Тело
                    ctx.fillStyle = '#5A3D5C';
                    ctx.fillRect(element.x - 2, element.y - 2, 4, 8);
                }
            }
        }
        
        // Отрисовка земли
        function drawGround() {
            // Трава
            ctx.fillStyle = '#A8E6CF';
            ctx.fillRect(0, GROUND_LEVEL, canvas.width, GROUND_HEIGHT);
            
            // Верхняя граница травы
            ctx.strokeStyle = '#8CDBA9';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, GROUND_LEVEL);
            
            // Волнистая линия
            for (let i = 0; i < canvas.width; i += 20) {
                const x = i;
                const y = GROUND_LEVEL + Math.sin(i / 30 + game.frames * 0.05) * 10;
                ctx.lineTo(x, y);
            }
            
            ctx.lineTo(canvas.width, GROUND_LEVEL);
            ctx.stroke();
            
            // Цветочки
            ctx.fillStyle = '#FF6B9D';
            for (let i = 0; i < canvas.width; i += 40) {
                const x = (i + game.frames * 0.5) % canvas.width;
                if (x < canvas.width) {
                    // Стебель
                    ctx.strokeStyle = '#8CDBA9';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(x, GROUND_LEVEL + 5);
                    ctx.lineTo(x, GROUND_LEVEL + 25);
                    ctx.stroke();
                    
                    // Цветок
                    ctx.beginPath();
                    ctx.arc(x, GROUND_LEVEL + 20, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Лепестки
                    for (let j = 0; j < 6; j++) {
                        const angle = (j / 6) * Math.PI * 2;
                        const px = x + Math.cos(angle) * 10;
                        const py = GROUND_LEVEL + 20 + Math.sin(angle) * 10;
                        
                        ctx.beginPath();
                        ctx.arc(px, py, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // Центр цветка
                    ctx.fillStyle = '#FFF9B2';
                    ctx.beginPath();
                    ctx.arc(x, GROUND_LEVEL + 20, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#FF6B9D';
                }
            }
        }
        
        // Отрисовка кота
        function drawCat() {
            const { x, y, width, height, color } = cat;
            
            // Тело кота
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(x + width / 2, y + height / 2, width / 2, height / 2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Ушки
            ctx.fillStyle = color;
            // Левое ухо
            ctx.beginPath();
            ctx.moveTo(x + width * 0.3, y + height * 0.2);
            ctx.lineTo(x + width * 0.2, y + height * 0.05);
            ctx.lineTo(x + width * 0.4, y + height * 0.1);
            ctx.fill();
            // Правое ухо
            ctx.beginPath();
            ctx.moveTo(x + width * 0.7, y + height * 0.2);
            ctx.lineTo(x + width * 0.8, y + height * 0.05);
            ctx.lineTo(x + width * 0.6, y + height * 0.1);
            ctx.fill();
            
            // Внутренняя часть ушей
            ctx.fillStyle = '#FFD1E0';
            // Левое ухо
            ctx.beginPath();
            ctx.moveTo(x + width * 0.3, y + height * 0.18);
            ctx.lineTo(x + width * 0.25, y + height * 0.08);
            ctx.lineTo(x + width * 0.38, y + height * 0.12);
            ctx.fill();
            // Правое ухо
            ctx.beginPath();
            ctx.moveTo(x + width * 0.7, y + height * 0.18);
            ctx.lineTo(x + width * 0.75, y + height * 0.08);
            ctx.lineTo(x + width * 0.62, y + height * 0.12);
            ctx.fill();
            
            // Глаза
            ctx.fillStyle = '#5A3D5C';
            // Левый глаз
            ctx.beginPath();
            ctx.ellipse(x + width * 0.4, y + height * 0.4, 6, 8, 0, 0, Math.PI * 2);
            ctx.fill();
            // Правый глаз
            ctx.beginPath();
            ctx.ellipse(x + width * 0.6, y + height * 0.4, 6, 8, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Зрачки (двигаются в зависимости от положения)
            const pupilOffsetX = Math.sin(game.frames * 0.1) * 2;
            const pupilOffsetY = Math.cos(game.frames * 0.05) * 1;
            
            ctx.fillStyle = 'white';
            // Левый зрачок
            ctx.beginPath();
            ctx.ellipse(x + width * 0.4 + pupilOffsetX, y + height * 0.4 + pupilOffsetY, 3, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            // Правый зрачок
            ctx.beginPath();
            ctx.ellipse(x + width * 0.6 + pupilOffsetX, y + height * 0.4 + pupilOffsetY, 3, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Носик
            ctx.fillStyle = '#FF6B9D';
            ctx.beginPath();
            ctx.ellipse(x + width * 0.5, y + height * 0.55, 4, 3, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Ротик
            ctx.strokeStyle = '#5A3D5C';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x + width * 0.5, y + height * 0.58);
            ctx.lineTo(x + width * 0.5, y + height * 0.62);
            ctx.stroke();
            
            // Усы
            ctx.strokeStyle = '#5A3D5C';
            ctx.lineWidth = 1;
            // Левые усы
            ctx.beginPath();
            ctx.moveTo(x + width * 0.3, y + height * 0.55);
            ctx.lineTo(x + width * 0.1, y + height * 0.5);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + width * 0.3, y + height * 0.58);
            ctx.lineTo(x + width * 0.1, y + height * 0.58);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + width * 0.3, y + height * 0.61);
            ctx.lineTo(x + width * 0.1, y + height * 0.66);
            ctx.stroke();
            // Правые усы
            ctx.beginPath();
            ctx.moveTo(x + width * 0.7, y + height * 0.55);
            ctx.lineTo(x + width * 0.9, y + height * 0.5);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + width * 0.7, y + height * 0.58);
            ctx.lineTo(x + width * 0.9, y + height * 0.58);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x + width * 0.7, y + height * 0.61);
            ctx.lineTo(x + width * 0.9, y + height * 0.66);
            ctx.stroke();
            
            // Лапки (анимация бега)
            const legOffset = Math.sin(game.frames * 0.2) * 5;
            
            // Передние лапки
            ctx.fillStyle = color;
            // Левая
            ctx.fillRect(x + width * 0.35, y + height * 0.8, 8, 15 + legOffset);
            // Правая
            ctx.fillRect(x + width * 0.55, y + height * 0.8, 8, 15 - legOffset);
            
            // Задние лапки
            // Левая
            ctx.fillRect(x + width * 0.25, y + height * 0.8, 8, 15 - legOffset);
            // Правая
            ctx.fillRect(x + width * 0.65, y + height * 0.8, 8, 15 + legOffset);
            
            // Хвост (виляет)
            const tailOffset = Math.sin(game.frames * 0.15) * 10;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x + width * 0.9, y + height * 0.7);
            ctx.quadraticCurveTo(x + width + 30 + tailOffset, y + height * 0.5, x + width * 0.8, y + height * 0.9);
            ctx.fill();
            
            // Отладочная информация (хитбокс)
            if (false) { // Установите true для отображения хитбокса
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    cat.x + 20, // Хитбокс X
                    cat.y + 10, // Хитбокс Y
                    cat.width - 40, // Хитбокс ширина
                    cat.height - 20 // Хитбокс высота
                );
            }
        }
        
        // Отрисовка препятствий
        function drawObstacles() {
            for (let obstacle of obstacles) {
                ctx.fillStyle = obstacle.color;
                
                if (obstacle.type === 'подушка') {
                    // Подушка
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    
                    // Узор на подушке
                    ctx.fillStyle = '#9DDFC7';
                    ctx.fillRect(obstacle.x + 5, obstacle.y + 5, obstacle.width - 10, 8);
                    ctx.fillRect(obstacle.x + 5, obstacle.y + obstacle.height - 13, obstacle.width - 10, 8);
                    
                } else if (obstacle.type === 'клубок') {
                    // Клубок (шар)
                    ctx.beginPath();
                    ctx.arc(
                        obstacle.x + obstacle.width / 2,
                        obstacle.y + obstacle.height / 2,
                        obstacle.width / 2,
                        0,
                        Math.PI * 2
                    );
                    ctx.fill();
                    
                    // Ниточки на клубке
                    ctx.strokeStyle = '#FF8A8A';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(
                        obstacle.x + obstacle.width / 2,
                        obstacle.y + obstacle.height / 2,
                        obstacle.width / 2 - 3,
                        0,
                        Math.PI * 1.5
                    );
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.arc(
                        obstacle.x + obstacle.width / 2,
                        obstacle.y + obstacle.height / 2,
                        obstacle.width / 2 - 8,
                        Math.PI * 0.5,
                        Math.PI * 2
                    );
                    ctx.stroke();
                    
                } else if (obstacle.type === 'чашка') {
                    // Чашка
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                    
                    // Внутренняя часть чашки
                    ctx.fillStyle = '#A5B4FC';
                    ctx.fillRect(obstacle.x + 5, obstacle.y + 5, obstacle.width - 10, obstacle.height - 10);
                    
                    // Ручка
                    ctx.fillStyle = obstacle.color;
                    ctx.beginPath();
                    ctx.arc(
                        obstacle.x + obstacle.width,
                        obstacle.y + obstacle.height / 2,
                        10,
                        Math.PI / 2,
                        Math.PI * 1.5
                    );
                    ctx.fill();
                    
                    // Молоко в чашке
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(obstacle.x + 7, obstacle.y + obstacle.height - 15, obstacle.width - 14, 10);
                }
                
                // Отладочная информация (хитбокс препятствия)
                if (false) { // Установите true для отображения хитбокса
                    ctx.strokeStyle = 'blue';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(
                        obstacle.x + 5,
                        obstacle.y + 5,
                        obstacle.width - 10,
                        obstacle.height - 10
                    );
                }
            }
        }
        
        // Отрисовка частиц
        function drawParticles() {
            for (let particle of particles) {
                ctx.globalAlpha = particle.life / 100;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1.0;
        }
        
        // Создание частиц
        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: 3 + Math.random() * 5,
                    color: color,
                    vx: -5 + Math.random() * 10,
                    vy: -5 + Math.random() * 5,
                    life: 50 + Math.random() * 50
                });
            }
        }
        
        // Обновление интерфейса
        function updateUI() {
            scoreElement.textContent = Math.floor(game.score);
            highScoreElement.textContent = Math.floor(game.highScore);
        }
        
        // Прыжок кота
        function jump() {
            if (!cat.isJumping && game.running) {
                cat.velocityY = -cat.jumpForce;
                cat.isJumping = true;
                
                // Создаем частицы при прыжке
                createParticles(cat.x + cat.width / 2, cat.y + cat.height, 10, '#FFD166');
                
                // Звук прыжка
                if (game.soundEnabled) {
                    jumpSound.currentTime = 0;
                    jumpSound.play().catch(e => console.log("Audio error:", e));
                }
            }
        }
        
        // Конец игры
        function gameOver() {
            game.running = false;
            
            // Создаем частицы при окончании игры
            createParticles(cat.x + cat.width / 2, cat.y + cat.height / 2, 50, '#FF6B9D');
            
            // Обновление рекорда
            if (game.score > game.highScore) {
                game.highScore = game.score;
                localStorage.setItem('catHighScore', game.highScore);
            }
            
            // Показываем экран завершения игры
            finalScoreElement.textContent = Math.floor(game.score);
            finalHighScoreElement.textContent = Math.floor(game.highScore);
            gameOverScreen.style.display = 'flex';
            
            // Звук окончания игры
            if (game.soundEnabled) {
                gameoverSound.currentTime = 0;
                gameoverSound.play().catch(e => console.log("Audio error:", e));
            }
        }
        
        // Переключение звука
        function toggleSound() {
            game.soundEnabled = !game.soundEnabled;
            
            if (game.soundEnabled) {
                soundBtn.innerHTML = '<i class="fas fa-volume-up"></i> Звук Вкл';
                soundBtn.classList.remove('btn-secondary');
                soundBtn.classList.add('btn-primary');
            } else {
                soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i> Звук Выкл';
                soundBtn.classList.remove('btn-primary');
                soundBtn.classList.add('btn-secondary');
            }
        }
        
        // Обработчики событий
        startBtn.addEventListener('click', init);
        jumpBtn.addEventListener('click', jump);
        mobileJumpBtn.addEventListener('click', jump);
        soundBtn.addEventListener('click', toggleSound);
        restartBtn.addEventListener('click', init);
        
        // Управление с клавиатуры
        document.addEventListener('keydown', (e) => {
            if ((e.code === 'Space' || e.code === 'ArrowUp') && game.running) {
                e.preventDefault();
                jump();
            }
        });
        
        // Управление касанием на canvas
        canvas.addEventListener('click', (e) => {
            if (game.running) {
                jump();
            }
        });
        
        // Адаптация к изменению размера окна
        window.addEventListener('resize', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            // Пересчитываем уровень земли при изменении размера
            GROUND_LEVEL = canvas.height - GROUND_HEIGHT;
            // Корректируем позицию кота
            cat.y = GROUND_LEVEL - cat.height;
        });
        
        // Инициализация при загрузке
        window.addEventListener('load', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            highScoreElement.textContent = Math.floor(game.highScore);
        });
    </script>
</body>
</html>
